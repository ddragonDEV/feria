{% extends "::base_mapa.html.twig" %}
{% block bodyclass %} {{ bodyclasss }} {% endblock %}
	{% block body %}
		<header id="main_header" class="uc-header">
			<nav class="uc-navbar">
				<!-- Menú para versión Escritorio -->
				<div class="container d-none d-lg-block">
					<div class="row align-items-center">
						<div class="col-lg-3 col-xl-2">
							<img src="https://kit-digital-uc-prod.s3.amazonaws.com/assets/logo-uc-color.svg" alt="Logo de Facultad" class="img-fluid">
						</div>
						<div class="col-lg-8 col-xl-9">
							<div class="h2 text-font--serif text-color--blue mt-24">Expo Virtual Futuro Novato y Novata 2021</div>
							<div class="text-color--gray p-size--lg">Descubre nuestras carreras y vive la experiencia universitaria en la UC</div>
						</div>
						<a class="uc-navbar_mobile-button" data-collapse="collapseMobileNav3">
							<span class="uc-icon"></span>
							<!--						Menú-->
						</a>
					</div>
				</div>
				<!-- Menú para versión Móvil -->
				<div class="uc-navbar_mobile d-block d-lg-none">
					<div class="uc-navbar_mobile-bar navbar-brand">
						<div class="uc-navbar_mobile-logo navbar-light">
							<div class="h2 text-font--serif text-color--blue">Expo Virtual Futuro Novato UC 2021</div>
						</div>
						<a class="uc-navbar_mobile-button" data-collapse="collapseMobileNav3">
							<span class="uc-icon"></span>
							Menú
						</a>
					</div>
				</div>
			</nav>
		</header>
		<div class="asombroso" style="z-index: 9999999999999999999999999999999999;
		/* background-color: black; */
		text-align: center;
		position: absolute;
		display:none;
	}">
	Holaaaa
</div>
<div id="sltr_menu">
	<ul>
		<li>
			<a style="cursor: pointer;" id="btn_feria_carreras_servicios">Feria de carreras y servicios</a>
		</li>
		<li>
			<a style="cursor: pointer;" class="btn_comunidad_uc">¿Cómo postulo a la UC?</a>
		</li>
		<li>
			<a style="cursor: pointer;" href="#">Rinde el Ensayo Online</a>
		</li>
		<li class="nav-item">
			<a style="cursor: pointer;" id="btn_programa_charlas">Únete a las charlas en vivo</a>
		</li>
		<li>
			<a style="cursor: pointer;" id="btn_conoce_uc">Conoce más de la UC</a>
		</li>
		<li>
			<a style="cursor: pointer;" href="{{ path('perfil') }}">Perfil</a>
		</li>
		<li>
			<a style="cursor: pointer;" href="{{ path('logout') }}">Cerrar sesión</a>
		</li>
			{# <li>
				<ul>
					<li>
						<a href="#"><i class="fab fa-facebook"></i></a>
					</li>
					<li>
						<a href="#"><i class="fab fa-instagram"></i></a>
					</li>
					<li>
						<a href="#"><i class="fab fa-youtube"></i></a>
					</li>
				</ul>
			</li> #}
		</ul>
		<div style="position: fixed;top:95%;font-size: 11.5px;color: #747474;">
			<p>Desarrollado por <a style="color: #747474;" href="https://www.imaginachile.com/">Imagina</a></p>
		</div>
	</div>
	<button id="to--top" data-aria-hidden="true"><i class="uc-icon">arrow_upward</i></button>
	<div id="popup--bg" class="popup" data-aria-hidden="true"></div>

	<aside id="popup--menu" class="popup" data-aria-hidden="true"><b class="popup--close">&times;</b><b class="popup--back"><i class="uc-icon">arrow_back</i>&nbsp;Volver a Carreras</b>
		<div>
			<div class="pop_in">
				<div class="holder">
				</div>
			</div>
		</div>
	</aside>

	<aside id="fixy">
		<a href="#" target="_blank">
			<img src="{{ asset('bundles/app/mapa/svg/icono_ensayo.svg') }}" alt="" />
		</a>
	</aside>

	<aside id="popup--carreras" class="popup" data-aria-hidden="true">
		<div>
			<div class="pop_in">
				<i class="popup--close"></i><b class="popup--close">&times;</b>
				<div class="holder">
					<div class="loading--text" style="display: none;" data-aria-hidden="true"><i class="fas fa-spinner fa-spin color--azul"></i><span class="h6">Cargando&hellip;</span></div>
					<div class="holder_in" style="display: none;">
						<!-- AQUI VA A CARGAR EL AJAX -->
						{# <h3 class="h2">Selecciona una carrera y comienza el recorrido</h3> #}
						<h3 class="h2">Selecciona y comienza el recorrido</h3>
						<div class="p--card">
							<ul class="carreras"></ul>
						</div>
					</div>
				</div>
			</div>
		</div>
	</aside>

	<aside id="popup--normal" class="popup" data-aria-hidden="true">
		<div>
			<div class="pop_in"><i class="popup--close"></i><b class="popup--close">&times;</b>
				<div class="holder">
					 <div class="menu">
						<h3><span class="carrera--name">Medicina veterinaria</span></h3>
						<nav>
							<ul>
								<li><button>
										<div><span>Información<br />general</span><i class="uc-icon">arrow_right_alt</i></div>
									</button></li>
								<li><button>
										<div><span>Cronograma<br />charlas</span><i class="uc-icon">arrow_right_alt</i></div>
									</button></li>
								<li><a href="#" target="_blank">
										<div><span>Chat</span><i class="uc-icon">open_in_new</i></div>
									</a></li>
							</ul>
						</nav>
					</div> 
					<div id="Hola" class="content">
						<div class="loading--text" data-aria-hidden="true"><i class="fas fa-spinner fa-spin color--azul"></i><span class="h6">Cargando&hellip;</span></div>
						<div class="content_in">
							<!-- AQUI VA A CARGAR EL AJAX -->

							<div class="bloque media imagen">
								<div class="in">
									<figure>
										<img src="./img/test1.jpg" alt="" />
									</figure>
								</div>
							</div>

							<div class="bloque texto">
								<div class="in">
									<ul>
										<li><strong>Grado Académico:</strong> Bachiller / Licenciado en Ciencias Veterinarias</li>
										<li><strong>Título Profesional:</strong> Médico Veterinario</li>
										<li><strong>Vacantes ofrecidas Admisión 2020:</strong> 80</li>
										<li><strong>Código DEMRE:</strong> 12033</li>
									</ul>
									<h3>¿Cómo ingresar?</h3>
									<p>Admisión Centralizada 2021<br />
										<strong>Otras vías de admisión a la UC:</strong> Admisión Equidad / Admisión Especial
									</p>
								</div>
							</div>

							<div class="bloque texto requisitos">
								<div class="in">
									<h3>Ponderaciones y Requisitos</h3>
									<ul class="requisitos-ul">
										<li>
											<div><span>20%</span> Promedio Enseñanza Media</div>
										</li>
										<li>
											<div><span>20%</span> Lorem ipsum</div>
										</li>
										<li>
											<div><span>20%</span> Lorem ipsum</div>
										</li>
										<li>
											<div><span>20%</span> Lorem ipsum</div>
										</li>
										<li>
											<div><span>20%</span> Lorem ipsum</div>
										</li>
										<li>
											<div>Lorem ipsum</div>
										</li>
									</ul>
								</div>
							</div>

							<div class="bloque texto">
								<div class="in">
									<h3>¿Qué significa ser Médico Veterinario?</h3>
									<p>Los médicos veterinarios son responsables de la salud y el bienestar de los animales en todos los ámbitos de su relación con el ser humano. También, es parte de su quehacer la preservación de ecosistemas y conservación de fauna libre de enfermedades. Asimismo, contribuyen a garantizar la inocuidad de los alimentos para el consumo humano, protegiendo su integridad y calidad desde el campo a la mesa.</p>
									<h3>Perfil de egreso</h3>
									<p>El médico veterinario de la UC tendrá una sólida formación ética y científico– tecnológica. Será capaz de diagnosticar el estado de salud y bienestar de los animales a su cargo. Aplicará la medicina para prevenir y tratar enfermedades en los animales, proteger la biodiversidad y el medio ambiente, y contribuir a la adecuada producción de alimentos de origen animal. Este profesional tendrá un especial énfasis en la medicina animal, con foco en caninos y felinos, o equinos.<br />
										Será capaz de investigar, analizar y sintetizar conocimientos. Participará en la planificación, desarrollo y evaluación de proyectos y programas relacionados con las ciencias veterinarias: salud y bienestar animal, salud pública, producción animal, calidad e inocuidad de los alimentos y biodiversidad.</p>
									</div>
								</div>

								<div class="bloque media galeria">
									<div class="in">
										<h3>Galería</h3>
										<div class="slider_holder">
										</div>
									</div>
								</div>

								<div class="bloque media videos">
									<div class="in">
										<h3>Videos</h3>
										<div class="video_holder"></div>
										<ul>
											<li>
												<div><button data-youtube="cjm5pBvaWTI"><img src="{{ asset('bundles/app/mapa/img/test2.jpg') }}" alt="" /></button></div>
											</li>
											<li>
												<div><button data-youtube="JwMIo45vMvM"><img src="{{ asset('bundles/app/mapa/img/test2.jpg') }}" alt="" /></button></div>
											</li>
											<li>
												<div><button data-youtube="cjm5pBvaWTI"><img src="{{ asset('bundles/app/mapa/img/test3.jpg') }}" alt="" /></button></div>
											</li>
											<li>
												<div><button data-youtube="JwMIo45vMvM"><img src="{{ asset('bundles/app/mapa/img/test4.jpg') }}" alt="" /></button></div>
											</li>
										</ul>
									</div>
								</div>

								<div class="bloque texto social">
									<div class="in">
										<h3>Síguenos</h3>
										<ul>
											<li><a href="#" target="_blank"><i class="fab fa-facebook"></i></a></li>
											<li><a href="#" target="_blank"><i class="fab fa-instagram"></i></a></li>
											<li><a href="#" target="_blank"><i class="fab fa-twitter"></i></a></li>
										</ul>
									</div>
								</div>

							</div>
						</div>
					</div>
				</div>
			</div>
		</aside>

		<div id="cursor-a" class="cursor">
			<div class="a">{{ cursor_a|raw }}</div>
		</div>

		<div id="cursor-b" class="cursor">
			<div class="b">{{ cursor_b|raw }}</div>
		</div>

		<section id="preloader">
			<div>
				<div class="logo_uc">{{ logo_uc|raw }}</div>
				<div class="logo_feria">{{ logo_feria|raw }}</div>
				<div class="text">
					<div class="loading--text" data-aria-hidden="true"><i class="fas fa-spinner fa-spin color--azul"></i><span class="h6">Cargando&hellip;</span></div>
				</div>
			</div>
		</section>

		<section id="instrucciones">
			<div>
				{% if mobile == false %}
					<div class="cursor">
						<div class="a">{{ cursor_a|raw }}</div>
						<div class="b">{{ cursor_b|raw }}</div>
					</div>
				{% endif %}			
				<p>Haz {% if mobile %} tap {% else %} clic y mantén presionado el mouse {% endif %} para <strong>moverte por el mapa</strong> y conocer las diferentes actividades de la Expo Virtual Futuro Novato.</p>
				<button class="uc-btn btn-cta">
					Comenzar&nbsp;<i class="uc-icon">arrow_forward</i>
				</button>
			</div>
		</section>

		<section id="map">
			<div id="markers">
				{{ markers|raw }}
			</div>
		</section>

		<footer id="main_footer" class="uc-footer">
			<div class="container">
				<div class="row justify-content-between">
					<div class="logo">
						<a href="/">
							<img src="{{ asset('bundles/app/mapa/svg/Acreditación - gratuidad.svg') }}" alt="" class="img-fluid">
						</a>
					</div>
				{# <div class="logo">
					<a href="/">
						<img src="{{ asset('bundles/app/mapa/svg/acreditacion-01.svg') }}" alt="" class="img-fluid">
					</a>
				</div>
				<div class="logo">
					<a href="/" style="width: 7rem;">
						<img src="{{ asset('bundles/app/mapa/svg/acreditacion-02.svg') }}" alt="" class="img-fluid">
					</a>
				</div>
				<div class="logo">
					<a href="/">
						<img src="{{ asset('bundles/app/mapa/svg/acreditacion-03.svg') }}" alt="" class="img-fluid">
					</a>
				</div> #}
				<div class="social">
					<ul class="uc-footer_social">
						<!-- agregar enlaces a redes sociales correspondientes -->
						<li>
							<a href="https://www.facebook.com/admisionenlauc/" target="_blank">
								<img src="https://kit-digital-uc-prod.s3.amazonaws.com/assets/social-icon-facebook.svg" alt="Facebook">
							</a>
						</li>
						<li>
							<a href="https://www.instagram.com/admisionuc/?hl=es-la"  target="_blank">
								<img src="https://kit-digital-uc-prod.s3.amazonaws.com/assets/social-icon-instagram.svg" alt="Instagram">
							</a>
						</li>
						<li>
							<a href="https://www.youtube.com/channel/UCwpok7_Wf2xLAmVKaskUPvg" target="_blank">
								<img src="https://kit-digital-uc-prod.s3.amazonaws.com/assets/social-icon-youtube.svg" alt="Youtube">
							</a>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</footer>
{% endblock %}
{% block javascripts %}

	<script>
	const name = "ItsWork"

	if (location.hash === "#test") {
		setTimeout(console.log(name), 0)
		alert("aaaa");
		$('.asombroso').css('display', 'block');

	}


	</script>

	<script type="text/javascript">
	const duration = 250,
	largoinicial = 27,
	loader = PIXI.Loader.shared,
	sprites = {},
	cursor = $('#cursor-a'),
	cursorb = $('#cursor-b'),
	cursorSpeed = .5,
			// mapaRatio = 0.7;
			mapaRatio = 3549/4500;

			var canvasCreated = false,
			app,
			viewport,
			vid1Controller,
			mouseMoving = false,
			activeMarkerOffset = 0,
			headerHeight = parseInt($('#main_header').outerHeight()),
			footerHeight = parseInt($('#main_footer').outerHeight()),
			sliderz = false;
			if (window.innerWidth > window.innerHeight) {
				var mapaWidth = window.innerWidth * 2,
				mapaHeight = mapaWidth * mapaRatio,
				mapaStartZoom = mapaWidth * .2;
			} else {
				var mapaWidth = (((window.innerHeight - (headerHeight + footerHeight)) * 2) / (mapaRatio * 10)) * 10,
				mapaHeight = (window.innerHeight - (headerHeight + footerHeight)) * 2,
				mapaStartZoom = mapaWidth * .15;
			}

			let cursorX = 0,
			cursorY     = 0,
			distX       = 0,
			distY       = 0,
			mouseX      = 0,
			mouseY      = 0;

			function rand(n) {
				return Math.round(Math.random() * n)
			}

			function checkScroll(val) {
				if ($('body').hasClass('has--popup-carreras') || $('body').hasClass('has--popup-normal')) {
					if ($('body').hasClass('has--popup-carreras')) {
						var nS = parseInt($('#popup--carreras').scrollTop());
						var tope = parseInt($('#popup--carreras > div').outerHeight()) - $h + (headerHeight * 2);
					} else if ($('body').hasClass('has--popup-normal')) {
						var nS = parseInt($('#popup--normal').scrollTop());
						var tope = parseInt($('#popup--normal > div').outerHeight()) - $h + (headerHeight * 2);
					}
					if (nS < tope) {
					//					$('.popup i.popup--close').css('transform', 'translateY(' + nS + 'px)');
				}
				if (nS > $h) {
					$('body').addClass('scrolled');
				} else {
					$('body').removeClass('scrolled');
				}
			} else {
				//				$('.popup i.popup--close').css('transform', '');
			}
		}

		function afterAjax() {
			resizable();
		}

		function resizable(viewportResize = true) {
			console.log(111);
			$w = window.innerWidth;
			$h = window.innerHeight;
			document.body.height = $h;
			$('html, body, .win--width, canvas').css('width', $w + 'px');
			$('html, body, .win--height, canvas').css('height', $h + 'px');
			headerHeight = parseInt($('#main_header').outerHeight());
			footerHeight = parseInt($('#main_footer').outerHeight());
			$(':root').css({
				'--headerheight': headerHeight + 'px',
				'--footerheight': footerHeight + 'px'
			});

			if ($w >= $h) {
				console.log(222);
				mapaWidth = $w * 2;
				mapaHeight = mapaWidth * mapaRatio;
				mapaStartZoom = mapaWidth * .2;
				console.log($('#popup--normal .content .bloque.charlas').length);
				console.log($('#popup--normal .content .bloque.galeria').length);
				console.log(sliderz);
				if (($('#popup--normal .content .bloque.charlas').length || $('#popup--normal .content .bloque.galeria').length) && !sliderz) {
					console.log(333);
					$('.slider_holder').each(function () {

						if (($(this).hasClass('slider--charlas') && $('.slider', this).children().length > 3) || ($(this).hasClass('slider--galeria') && $('.slider', this).children().length > 2)) {

							if ($(this).hasClass('slider--charlas') && $('.slider', this).children().length > 3) {
								var countt = 3;
							} else {
								var countt = 2;
							}
							var sliderr = $('.slider', this);
							sliderr.slick({
								dots: false,
								arrows: true,
								speed: 750,
								pauseOnHover: true,
								autoplay: false,
								draggable: true,
								accessibility: false,
								centerMode: false,
								infinite: false,
								slidesToShow: countt,
								slidesToScroll: 1,
								prevArrow: '<button type="button" class="slick-prev slick-arrow"><i class="fas fa-chevron-left"></i></button>',
								nextArrow: '<button type="button" class="slick-next slick-arrow"><i class="fas fa-chevron-right"></i></button>',
								cssEase: 'cubic-bezier(0.77, 0, 0.175, 1)'
							});
							sliderz = true;
						}
					});
				}
			} else {
				mapaWidth = ((($h - (headerHeight + footerHeight)) * 2) / (mapaRatio * 10)) * 10;
				mapaHeight = ($h - (headerHeight + footerHeight)) * 2;
				mapaStartZoom = mapaWidth * .15;
				if (($('#popup--normal .content .bloque.charlas').length || $('#popup--normal .content .bloque.fotos').length) && sliderz) {
					$('.slider_holder').each(function () {
						if ($('.slick-list', this).length) {
							$('.slider', this).slick('unslick');
						}
					});
					sliderz = false;
					$('.slide').css('width', '');
				}
			}
			$('#sltr_menu').css({
				'top': headerHeight + 'px',
				'height': ($h - (headerHeight + footerHeight)) + 'px'
			});
		}

		function markersMove(x, y, clearInitial = false) {
			$('#markers').css('visibility', '');
			$('body').removeClass('markers--hidden');
			$('#markers').css('transform', 'translate3d(' + x + 'px, ' + y + 'px, 0)');
			if (clearInitial) {
				$('#preloader, #instrucciones').remove();
			}
		}

		function setVideos() {
			$('#popup--normal .bloque.videos').each(function () {
				$('ul li:first-of-type', this).addClass('active');
				$('.video_holder', this).html('<iframe src="https://www.youtube.com/embed/' + $('ul li:first-of-type button', this).attr('data-youtube') + '" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>');
			});
		}

		function setMenu() {
			$('#popup--menu .holder').append('<div class="menu" />');
			$('#popup--menu .menu').html($('#popup--normal .menu').html())
			$('.menu li:first-of-type').addClass('active');
		}

		function mapCreation() {
			if (!canvasCreated) {
				PIXI.utils.skipHello();
				app = new PIXI.Application({
					transparent: true,
					width: window.innerWidth,
					height: window.innerHeight - (headerHeight + footerHeight),
					resizeTo: window,
					autoResize: true,
					resolution: window.devicePixelRatio
				});
				$('#map').append(app.view);
				$('#markers').css({
					'width': mapaWidth + 'px',
					'height': mapaHeight + 'px'
				});
				viewport = app.stage.addChild(new Viewport.Viewport({
					screenWidth: window.innerWidth,
					screenHeight: window.innerHeight - (headerHeight + footerHeight),
					worldWidth: mapaWidth,
					worldHeight: mapaHeight
				}))
				.zoom(mapaStartZoom)
				.moveCenter(mapaWidth * .52, mapaHeight * .63)
				.drag({
					clampWheel: true,
					wheelScroll: .3
				})
					//					.pinch()
					.decelerate({
						friction: .8
					})
					.clamp({
						direction: 'all',
						underflow: 'center'
					})
					.on('moved', (data) => markersMove(data.viewport.x, data.viewport.y))
					.on('zoomed-end', (data) => markersMove(viewport.x, viewport.y, true));
				//				viewport.findCover(window.innerWidth, window.innerHeight);
				viewport.pause = true;
				app.renderer.interactive = true;
				assetsBase();
				canvasCreated = true;
			}
		}

		function assetsBase() {
			loader.add('mapa', '{{ asset('bundles/app/mapa/img/map-4000.jpg') }}')
			.load((loader, resources) => {
				sprites.mapa = new PIXI.Sprite(resources.mapa.texture);
			});
			loader.onComplete.add(() => {
				var mapa = sprites.mapa;
				mapa.width = mapaWidth;
				mapa.height = mapaWidth * mapaRatio;
				viewport.addChild(mapa);
				$('body').removeClass('loading');
			});
		}

		function rollMapVids() {
			const vid = PIXI.Texture.from(loader.resources.vid1.url);
			const vid1 = new PIXI.Sprite(vid);
			vid1Controller = vid1.texture.baseTexture.resource.source;
			vid1Controller.autoplay = false;
			vid1Controller.setAttribute('autoplay', false);
			vid1.width = mapaWidth * .3;
			vid1.height = mapaWidth * .3 * .5625;
			vid1.x = mapaWidth * .2;
			vid1.y = 150;
			vid1Controller.setAttribute('loop', true);
			vid1Controller.setAttribute('muted', true);
			viewport.addChild(vid1);
		}

		function todoeljs() {

			if ($('body').hasClass('debug')) {
				$('body').append('<div id="centercheck" />');
			}

			$('html, body').bind('scroll mousedown DOMMouseScroll mousewheel', function () {
				$('html, body, .popup').stop();
			});

			if ($('body').hasClass('desktop')) {
				$(document).mousemove(function (e) {
					if (!mouseMoving) {
						cursor.css('opacity', 1);
						cursorb.css('opacity', 1);
					}
					if (!$('body').hasClass('has--popup-carreras') && !$('body').hasClass('has--popup-normal')) {
						mouseMoving = true;
						mouseX = e.pageX;
						mouseY = e.pageY;
					}
				});
			}

			var ofst = 0;
			$('.marker').each(function () {
				$(this).css('transition-delay', ofst + 'ms');
				$('.curva', this).css('transition-delay', ofst + 'ms');
				$('.sign', this).css('transition-delay', ofst + 150 + 'ms');
				ofst += 50;
			});

			setMenu();
			setVideos();

			resizable(false);
			mapCreation();
		}

		function cursorAnimate(event) {
			distX = mouseX - cursorX;
			distY = mouseY - cursorY;
			cursorX = cursorX + (distX * cursorSpeed);
			cursorY = cursorY + (distY * cursorSpeed);
			if ((distX < -.01 || distX > .01 || distY < -.01 || distY > .01)) {
				gsap.to(cursor, {
					x: cursorX,
					y: cursorY,
					'overwrite': 'auto',
					duration: 0.0,
				});
				gsap.to(cursorb, {
					x: mouseX,
					y: mouseY,
					'overwrite': 'auto',
					duration: 0.0,
				});
			}
			requestAnimationFrame(cursorAnimate);
		}

		function rollCursors() {
			cursorAnimate();
			mouseX = window.innerWidth / 2;
			mouseY = window.innerHeight / 2;
		}

		function pointer(){
			var slug = parseInt('{{pointer}}');
			if (slug > 0 ) {
				$(document).ready(function(){
					var b = $('button[data-id="{{pointer}}"]');
					b.click();
				});				
			}
		}



		$(document).ready(function () {

			if ($('body').hasClass('desktop')) {
				rollCursors();
			}

			$('.marker button').hover(function (e) {
				$('body').addClass('marker--hovered');
			}, function (e) {
				if (!$(this).hasClass('active')) {
					$('body').removeClass('marker--hovered');
				}
			});
			$(document).on('click', '.marker button', function (e) {
				console.log(e);
				$('body').addClass('marker--hovered');
				$('.marker, .marker .curva, .marker .sign').css('transition-delay', '');
				$(this).parent().addClass('active');
				$(this).parent().siblings('.active').removeClass('active');
				if ($(this).parent().hasClass('carreras')) {
					$('body').attr('data-openmarker', $(this).parent().attr('id'));
				}
				if (!$('body').hasClass('from--carreras')) {
					$('body').addClass('popup--delay');
				} else {
					$('body').addClass('popup--delay2');
				}
				setTimeout(function () {
					$('body').removeClass('popup--delay popup--delay2');
				}, duration * 4);
				if ($h > $w) {
					activeMarkerOffset = 0;
				} else {
					if ($(this).parent().hasClass('carreras')) {
						activeMarkerOffset = 0;
					} else {
						activeMarkerOffset = $w / 5;
					}
				}
				viewport.animate({
					position: new PIXI.Point(parseInt($(this).parent().css('left')) + activeMarkerOffset, parseInt($(this).parent().css('top'))),
					time: duration * 4,
					ease: 'easeInOutQuart'
				});
				$('body').addClass('map--opening map--opened');
				e.preventDefault();
			});

			pointer();


			$(document).on('pointerdown', '#instrucciones button', function () {
				$('body').removeClass('has--instrucciones');
				if (vid1Controller) {
					vid1Controller.play();
				}
				viewport.pause = false;
				viewport.snapZoom({
					width: window.innerWidth,
					time: duration * 6,
					ease: 'easeInOutQuart'
				});
			});

			$(document).on('click', '.btn--popup-carreras', function (e) {
				e.preventDefault();
				console.log(1);

				$('.loading--text').css('display', 'block');

				setTimeout(function () {
					viewport.pause = true;
				}, duration * 4);
				$('body').addClass('has--popup-carreras');

				var id = $(this).data('id');
				var path = Routing.generate("mapa_marker_obtener_stands");
				$.ajax({
					url: path,
					type: 'GET',
					data:{ idPunto:id},
					success: function (results) {
						setTimeout(function () {							
							$('.loading--text').css('display', 'none');
							$('#popup--carreras').find('.carreras').html(results);
							$('#popup--carreras').find('.holder_in').css('display', 'block');
						}, duration * 2);
					},
					error: function (e) {
						console.log(e);
					}
				});	
			});

			$(document).on('click', '.btn--popup-normal', function (e) {
				e.preventDefault();
				$('.loading--text').css('display', 'block');
				$('body').addClass('loading--interior');



				var id   = $(this).data('id');
				var tipo = $(this).data('tipo');

				$('#popup--carreras').find('.holder_in').css('display', 'none');

				setTimeout(function () {
					viewport.pause = true;
				}, duration * 4);
				var thiss = $(this);
				if (thiss.hasClass('no--menu')) {
					$('body').addClass('no--menu');
				} else {
					$('body').removeClass('no--menu');
				}

				if(tipo=="normal"){
					$('body').addClass('has--popup-normal');				
				}

				var path = Routing.generate("mapa_marker_obtener_informacion");
				$.ajax({
					url: path,
					type: 'GET',
					data:{ id:id, tipo:tipo},
					success: function (results) {
						$('#popup--normal').find('.holder').html(results);
						setTimeout(function () {							
							$('.loading--text').css('display', 'none');
							$('body').removeClass('loading--interior');

							if(tipo=="carreras"){
								$('body').addClass('has--popup-normal');
								if ($('body').hasClass('has--popup-carreras')) {
									$('body').addClass('from--carreras');
									$('body').removeClass('has--popup-carreras');
									$('body').addClass('popup--delay2');
								}

								setTimeout(function () {
									$('body').removeClass('popup--delay2');									
								}, duration * 2);
								$('#popup--menu .menu').html($('#popup--normal .menu').html())
								$('.menu li:first-of-type').addClass('active');
							}

							resizable();
							sliderz=false;

							setTimeout(function () {
								resizable();
								sliderz=false;
							}, duration * 5);

						}, duration * 2);
					},
					error: function (e) { 
						console.log(e);
					}
				});
			});

			$(document).on('click', '.popup--close', function (e) {
				$('body').removeAttr('data-openmarker');
				$('body').removeClass('has--popup-carreras has--popup-normal map--opening map--opened marker--hovered scrolled');
				$('.marker.active').removeClass('active');
				viewport.pause = false;
				setTimeout(function () {
					$('body').removeClass('from--carreras no--menu');
					$('.popup').removeClass('rolled--in');
					$('.popup').animate({
						scrollTop: 0
					}, 0);
				}, duration);
			});

			$(document).on('click', '.popup--back', function (e) {
				$('body').removeClass('has--popup-normal');
				$('#' + $('body').attr('data-openmarker') + ' button').click();
				setTimeout(function () {
					$('.popup').animate({
						scrollTop: 0
					}, 0);
				}, duration);
			});

			$(document).on('click', '.bloque.videos button', function (e) {
				$(this).parent().parent().addClass('active');
				$(this).parent().parent().siblings('.active').removeClass('active');
				$(this).parent().parent().parent().siblings('.video_holder').html('<iframe src="https://www.youtube.com/embed/' + $(this).attr('data-youtube') + '" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>');
				console.log($(this).parent().parent().parent().parent().parent().offset().top * -1);
				$('#popup--normal').animate({
					scrollTop: ($(this).parent().parent().parent().parent().parent().offset().top - $('#popup--normal').scrollTop() * -1) - (headerHeight + footerHeight)
				}, duration * 4, 'easeInOutQuart');
			});

			$(document).on('click', '.menu button', function (e) {
				console.log(3);				
				$(this).parent().addClass('active');
				$(this).parent().siblings('.active').removeClass('active');
				$('#popup--normal').animate({
					scrollTop: 0
				}, 0);
				$('.loading--text').css('display', 'block');
				$('body').addClass('loading--interior');
				
				var id   = $(this).data('id');
				var tipo = $(this).data('tipo');
				console.log(tipo);
				if(tipo == "carreras"){
					var path = Routing.generate("mapa_marker_obtener_informacion");
					$.ajax({
						url: path,
						type: 'GET',
						data:{ id:id, tipo:tipo},
						success: function (results) {
							$('#popup--normal').find('.holder').html(results);

							setTimeout(function () {							
								$('.loading--text').css('display', 'none');
								$('body').removeClass('loading--interior');	
							}, duration * 15);
						},
						error: function (e) { 
							console.log(e);
						}
					});
				}
				if( tipo == "charlas"){
					var path = Routing.generate("mapa_marker_obtener_charlas");
					$.ajax({
						url: path,
						type: 'GET',
						data:{ id:id, tipo:tipo},
						success: function (results) {	                	
							$('#popup--normal').find('.holder').html(results);
							setTimeout(function () {							
								$('.loading--text').css('display', 'none');
								$('body').removeClass('loading--interior');
							}, duration * 2);
						},
						error: function (e) {
							console.log(e);
						}
					});				
				}
				if( tipo == "chat"){
					$('body').addClass('no--menu');
					
					var path = Routing.generate("mapa_marker_obtener_chat");
					$.ajax({
						url: path,
						type: 'GET',
						data:{ id:id, tipo:tipo},
						success: function (results) {	                	
							$('#popup--normal').find('.holder').html(results);
							setTimeout(function () {							
								$('.loading--text').css('display', 'none');
								$('body').removeClass('loading--interior');

							}, duration * 10);
						},
						error: function (e) {
							console.log(e);
						}
					});	
				}
			});

			$(document).on('click', '.uc-navbar_mobile-button', function (e) {
				$('body').toggleClass('open--menu');
			});

			$(document).on('click', '#to--top', function (e) {
				$('#popup--normal').animate({
					scrollTop: 0
				}, duration * 4, 'easeInOutQuart');
			});

			if ($('body').hasClass('desktop')) {
				$(document).on('taphold', '#map canvas', {
					delay: 200
				}, function () {
					$('body').addClass('map--grabbing');
				})
				.on('pointerup', function () {
					$('body').removeClass('map--grabbing');
				});
			}

			todoeljs();
		});

$('#btn_feria_carreras_servicios').on('click',  function() {

				// es el id punto para que muestr las carreras stand.
				var id = 11;

				$('body').removeAttr('data-openmarker');
				$('body').removeClass('has--popup-carreras has--popup-normal map--opening map--opened marker--hovered scrolled');

				$('body').removeClass('from--carreras no--menu');
				$('.popup').removeClass('rolled--in')   

				$('.loading--text').css('display', 'block');
				setTimeout(function () {
					viewport.pause = true;
				}, duration * 4);
				$('body').addClass('has--popup-carreras');
				var path = Routing.generate("mapa_marker_obtener_stands");
				$.ajax({
					url: path,
					type: 'GET',
					data:{ idPunto:id},
					success: function (results) {
						setTimeout(function () {							
							$('.loading--text').css('display', 'none');
							$('#popup--carreras').find('.carreras').html(results);
							$('#popup--carreras').find('.holder_in').css('display', 'block');
						}, duration * 2);
					},
					error: function (e) {
						console.log(e);
					}
				});
				$('body').toggleClass('open--menu');
			});

$('.btn_comunidad_uc').on('click',  function() {

	$('body').removeAttr('data-openmarker');
	$('body').removeClass('has--popup-carreras has--popup-normal map--opening map--opened marker--hovered scrolled');

	$('body').removeClass('from--carreras no--menu');
	$('.popup').removeClass('rolled--in')


	$('.loading--text').css('display', 'block');
	$('body').addClass('loading--interior');	

	var id   = 62;
	var tipo = 'carreras';

	$('#popup--carreras').find('.holder_in').css('display', 'none');

	setTimeout(function () {
		viewport.pause = true;
	}, duration * 4);
	var thiss = $(this);
	if (thiss.hasClass('no--menu')) {
		$('body').addClass('no--menu');
	} else {
		$('body').removeClass('no--menu');
	}

	if(tipo=="normal"){
		$('body').addClass('has--popup-normal');				
	}

	var path = Routing.generate("mapa_marker_obtener_informacion");
	$.ajax({
		url: path,
		type: 'GET',
		data:{ id:id, tipo:tipo},
		success: function (results) {
			$('#popup--normal').find('.holder').html(results);
			setTimeout(function () {							
				$('.loading--text').css('display', 'none');
				$('body').removeClass('loading--interior');

				if(tipo=="carreras"){
					$('body').addClass('has--popup-normal');
					if ($('body').hasClass('has--popup-carreras')) {
						$('body').addClass('from--carreras');
						$('body').removeClass('has--popup-carreras');
						$('body').addClass('popup--delay2');
					}
					
					setTimeout(function () {
						$('body').removeClass('popup--delay2');
					}, duration * 2);
					$('#popup--menu .menu').html($('#popup--normal .menu').html())
					$('.menu li:first-of-type').addClass('active');
				}
				resizable();
			}, duration * 2);
		},
		error: function (e) { 
			console.log(e);
		}
	});
	$('body').toggleClass('open--menu');
});

$('#btn_programa_charlas').on('click',  function() {

	$('body').removeAttr('data-openmarker');
	$('body').removeClass('has--popup-carreras has--popup-normal map--opening map--opened marker--hovered scrolled');

	$('body').removeClass('from--carreras');
	$('.popup').removeClass('rolled--in');

	$('#popup--carreras').find('.holder_in').css('display', 'none');

	$('.loading--text').css('display', 'block');

	$('body').addClass('no--menu');

	$('body').addClass('has--popup-normal');

	$('body').addClass('loading--interior');	


	var path = Routing.generate("mapa_marker_obtener_charlas_all");
	$.ajax({
		url: path,
		type: 'GET',
		success: function (results) {
			$('#popup--normal').find('.holder').html(results);
			setTimeout(function () {							
				$('.loading--text').css('display', 'none');
				$('body').removeClass('loading--interior');

				resizable();
				sliderz=false;
			}, duration * 2);

		},
		error: function (e) { 
			console.log(e);
		}
	});
	$('body').toggleClass('open--menu');			
});

$('#btn_conoce_uc').on('click',  function() {

	$('body').removeAttr('data-openmarker');
	$('body').removeClass('has--popup-carreras has--popup-normal map--opening map--opened marker--hovered scrolled');

	$('body').removeClass('from--carreras no--menu');
	$('.popup').removeClass('rolled--in')   

	$('.loading--text').css('display', 'block');
	setTimeout(function () {
		viewport.pause = true;
	}, duration * 4);
	$('body').addClass('has--popup-carreras');
	var path = Routing.generate("mapa_marker_obtener_nivel_2");
	$.ajax({
		url: path,
		type: 'GET',
		success: function (results) {
			setTimeout(function () {							
				$('.loading--text').css('display', 'none');
				$('#popup--carreras').find('.carreras').html(results);
				$('#popup--carreras').find('.holder_in').css('display', 'block');
			}, duration * 2);
		},
		error: function (e) {
			console.log(e);
		}
	});
	$('body').toggleClass('open--menu');
});

$(window).resize($.debounce(duration, resizable));
$('#popup--normal').scroll($.throttle(100 / 60, checkScroll));
$('#popup--carreras').scroll($.throttle(100 / 60, checkScroll));

</script>
{% endblock %}
